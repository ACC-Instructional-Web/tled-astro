---
export const prerender = false;

import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import SidebarLeft from '~/components/widgets/SidebarLeft.astro';
import SidebarRight from '~/components/widgets/SidebarRight.astro';
import ACF from '~/components/widgets/ACF/ACF.astro';

import { pageData } from '~/config';

const { page } = Astro.params;

const slug = page ? page.split('?')[0].replace(/\/$/, '').split('/').pop() : '';

const response = await fetch(pageData + slug);

const data = await response.json();
const pageContent = data[0];

if (!pageContent) {
  Astro.response.status = 404;
  Astro.response.statusText = 'Not found';
}

const { title, content, acf } = pageContent;
const template = pageContent.template;

// console.log('template :>> ', template);
// console.log('pageContent :>> ', pageContent);

if (!pageContent) {
  Astro.response.status = 404;
  Astro.response.statusText = 'Not found';
}

const pageTitle = title ? title.rendered : 'Page not found';
// console.log('pageTitle :>> ', pageTitle);

// console.log('acf :>> ', acf);
const ACFData = pageContent ? acf : null;
const heroData = ACFData ? ACFData.hero_content : null;
---

<Layout>
  {
    // ########## HERO ##########
    heroData ? <div class="hero">{heroData[0].acf_fc_layout && <Hero data={heroData[0]} />}</div> : null
  }
  <div class="max-w-5xl mx-auto mb-8">
    {/* no sidebars */}
    {
      !template && content.rendered && (
        <>
          <h1>{pageTitle}</h1>
          <div set:html={content.rendered} />
        </>
      )
    }
    {/* End no sidebars */}
    {/* sidebar left only */}
    {
      template === 'page-sidebar-left.php' && (
        <SidebarLeft content={content.rendered} sidebar={ACFData.sidebar_left} title={pageTitle} />
      )
    }
    {/*  End sidebar left only */}

    {/* sidebar right only */}
    {
      template === 'page-sidebar-right.php' && (
        <SidebarRight content={content.rendered} sidebar={ACFData.sidebar_right} title={pageTitle} />
      )
    }
    {/*  End sidebar right only */}
  </div>
  {ACFData && <ACF layouts={ACFData.layouts} />}
</Layout>
